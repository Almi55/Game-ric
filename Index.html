<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Age of Dominion</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Roboto:wght@400;700&display=swap');

        :root {
            --bg-ocean: #1e2124;
            --land-neutral: #36393f;
            --land-player: #2e7d32;
            --land-enemy: #c62828;
            --ui-bg: rgba(20, 20, 20, 0.95);
            --gold: #ffd700;
            --text-main: #ffffff;
            --border-color: #000000;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-ocean);
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
            color: var(--text-main);
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ –°–¢–ê–¢–ò–°–¢–ò–ö–ò --- */
        #top-hud {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: var(--ui-bg);
            border-bottom: 2px solid #444;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .stat-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            color: #aaa;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            font-family: 'Cinzel', serif;
        }

        .gold-txt { color: var(--gold); text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }

        /* --- –ò–ì–†–û–í–ê–Ø –ö–ê–†–¢–ê --- */
        #map-container {
            margin-top: 70px; /* –û—Ç—Å—Ç—É–ø –æ—Ç —Ö–µ–¥–µ—Ä–∞ */
            height: calc(100vh - 160px);
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 10px;
        }

        #game-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫ */
            gap: 6px;
            width: 100%;
            max-width: 500px;
        }

        .province {
            aspect-ratio: 1;
            background-color: var(--land-neutral);
            border: 2px solid #222;
            border-radius: 8px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        .province.player { background: linear-gradient(135deg, #1b5e20, #2e7d32); border-color: #4caf50; }
        .province.enemy { background: linear-gradient(135deg, #b71c1c, #d32f2f); border-color: #ff5252; }

        .province.selected {
            transform: scale(1.05);
            border: 3px solid #fff;
            box-shadow: 0 0 15px rgba(255,255,255,0.6);
            z-index: 10;
        }

        .army-icon { font-size: 20px; margin-bottom: 2px; }
        .army-num { font-size: 16px; font-weight: bold; text-shadow: 1px 1px 2px black; }

        /* –ò–∫–æ–Ω–∫–∞ —Å—Ç–æ–ª–∏—Ü—ã */
        .capital::after {
            content: "‚òÖ";
            position: absolute;
            top: 2px;
            right: 5px;
            color: gold;
            font-size: 14px;
        }

        /* --- –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø --- */
        #bottom-hud {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 90px;
            background: var(--ui-bg);
            border-top: 2px solid #444;
            display: flex;
            justify-content: space-evenly;
            align-items: center;
            z-index: 100;
            padding-bottom: 15px; /* –î–ª—è iPhone */
        }

        .btn {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 10px 0;
            width: 30%;
            border-radius: 8px;
            font-family: 'Roboto', sans-serif;
            font-weight: bold;
            font-size: 13px;
            text-transform: uppercase;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            transition: background 0.2s;
        }

        .btn:active { transform: translateY(2px); }
        .btn-green { background: #1b5e20; border-color: #2e7d32; }
        .btn-red { background: #b71c1c; border-color: #d32f2f; }
        .btn-gold { background: #f57f17; border-color: #fbc02d; color: #000; }

        .btn:disabled { opacity: 0.3; filter: grayscale(100%); }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 16px;
            border: 1px solid #555;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 200;
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- –í–ï–†–• -->
    <div id="top-hud">
        <div class="stat-box">
            <span class="stat-value gold-txt" id="ui-gold">0</span>
            <span>–ö–∞–∑–Ω–∞</span>
        </div>
        <div class="stat-box">
            <span class="stat-value" id="ui-turn">1</span>
            <span>–•–æ–¥</span>
        </div>
        <div class="stat-box">
            <span class="stat-value" id="ui-provinces">1</span>
            <span>–ó–µ–º–ª–∏</span>
        </div>
    </div>

    <!-- –ö–ê–†–¢–ê -->
    <div id="map-container">
        <div id="game-grid"></div>
    </div>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
    <div id="toast" class="toast">–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å</div>

    <!-- –ù–ò–ó (–ö–ù–û–ü–ö–ò) -->
    <div id="bottom-hud">
        <button class="btn btn-green" id="btn-recruit" onclick="recruit()">
            <span>üõ° –ù–∞–Ω—è—Ç—å</span>
            <span style="font-size:10px; opacity:0.8;">15 –º–æ–Ω–µ—Ç</span>
        </button>

        <button class="btn btn-red" id="btn-attack" onclick="attack()" disabled>
            <span>‚öîÔ∏è –ê—Ç–∞–∫–∞</span>
            <span style="font-size:10px; opacity:0.8;">–í—ã–±–µ—Ä–∏ —Ü–µ–ª—å</span>
        </button>

        <button class="btn btn-gold" onclick="nextTurn()">
            <span>‚è≥ –°–ª–µ–¥. –•–æ–¥</span>
            <span style="font-size:10px; opacity:0.8;">+–î–æ—Ö–æ–¥</span>
        </button>
    </div>

    <script>
        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´ ---
        const GRID_SIZE = 16; // 4x4 –∫–∞—Ä—Ç–∞
        const RECRUIT_COST = 15;
        const INCOME_PER_LAND = 10;

        let gameState = {
            gold: 100,
            turn: 1,
            selected: null, // –ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–ª–µ—Ç–∫–∏
            lands: []
        };

        const mapEl = document.getElementById('game-grid');
        const uiGold = document.getElementById('ui-gold');
        const uiTurn = document.getElementById('ui-turn');
        const uiProv = document.getElementById('ui-provinces');
        const btnRecruit = document.getElementById('btn-recruit');
        const btnAttack = document.getElementById('btn-attack');
        const toastEl = document.getElementById('toast');

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        function init() {
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã
            for(let i=0; i<GRID_SIZE; i++) {
                let owner = 'neutral';
                let army = Math.floor(Math.random() * 5) + 1;

                // –ò–≥—Ä–æ–∫ —Å–≤–µ—Ä—Ö—É —Å–ª–µ–≤–∞
                if(i === 0) { owner = 'player'; army = 10; }
                // –í—Ä–∞–≥ —Å–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞
                if(i === GRID_SIZE - 1) { owner = 'enemy'; army = 10; }

                gameState.lands.push({ id: i, owner: owner, army: army });
            }
            renderMap();
            updateUI();
        }

        // --- –û–¢–†–ò–°–û–í–ö–ê –ö–ê–†–¢–´ ---
        function renderMap() {
            mapEl.innerHTML = '';
            gameState.lands.forEach((land, idx) => {
                const div = document.createElement('div');
                div.className = `province ${land.owner}`;
                if(idx === 0) div.classList.add('capital'); // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ —Å—Ç–æ–ª–∏—Ü—ã

                if(gameState.selected === idx) div.classList.add('selected');

                // –ò–∫–æ–Ω–∫–∞
                let icon = 'üå≤';
                if(land.owner === 'player') icon = 'üõ°';
                if(land.owner === 'enemy') icon = '‚ò†Ô∏è';

                div.innerHTML = `
                    <div class="army-icon">${icon}</div>
                    <div class="army-num">${land.army}</div>
                `;

                div.onclick = () => selectLand(idx);
                mapEl.appendChild(div);
            });
        }

        // --- –õ–û–ì–ò–ö–ê –í–´–ë–û–†–ê ---
        function selectLand(idx) {
            gameState.selected = idx;
            renderMap();
            checkButtons(idx);
        }

        function checkButtons(idx) {
            const land = gameState.lands[idx];

            // –ö–Ω–æ–ø–∫–∞ –Ω–∞–π–º–∞: —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–≤–æ–µ–π –∑–µ–º–ª–µ
            if(land.owner === 'player') {
                btnRecruit.disabled = false;
                btnRecruit.style.opacity = "1";
                btnAttack.disabled = true;
                btnAttack.innerHTML = `<span>‚öîÔ∏è –ê—Ç–∞–∫–∞</span><span style="font-size:10px">–≠—Ç–æ —Ç–≤–æ–µ</span>`;
            } else {
                btnRecruit.disabled = true;

                // –ö–Ω–æ–ø–∫–∞ –∞—Ç–∞–∫–∏: –¥–æ—Å—Ç—É–ø–Ω–∞, –µ—Å–ª–∏ —Ä—è–¥–æ–º –µ—Å—Ç—å –Ω–∞—à–∞ –∞—Ä–º–∏—è
                if(canAttack(idx)) {
                    btnAttack.disabled = false;
                    btnAttack.innerHTML = `<span>‚öîÔ∏è –ê—Ç–∞–∫–∞</span><span style="font-size:10px">–í –±–æ–π!</span>`;
                } else {
                    btnAttack.disabled = true;
                    btnAttack.innerHTML = `<span>‚öîÔ∏è –ê—Ç–∞–∫–∞</span><span style="font-size:10px">–î–∞–ª–µ–∫–æ</span>`;
                }
            }
        }

        function canAttack(targetIdx) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å–µ–¥–µ–π (–≤–µ—Ä—Ö, –Ω–∏–∑, –ª–µ–≤–æ, –ø—Ä–∞–≤–æ) –¥–ª—è —Å–µ—Ç–∫–∏ 4—Ö4
            const neighbors = [targetIdx-1, targetIdx+1, targetIdx-4, targetIdx+4];

            for(let n of neighbors) {
                if(n >= 0 && n < GRID_SIZE) {
                    // –£–±–∏—Ä–∞–µ–º –ø—Ä—ã–∂–∫–∏ —á–µ—Ä–µ–∑ –∫—Ä–∞–π —Å—Ç—Ä–æ–∫–∏
                    if(targetIdx % 4 === 0 && n === targetIdx - 1) continue;
                    if(targetIdx % 4 === 3 && n === targetIdx + 1) continue;

                    // –ï—Å–ª–∏ —Ä—è–¥–æ–º –Ω–∞—à–∞ –ø—Ä–æ–≤–∏–Ω—Ü–∏—è –∏ —Ç–∞–º –µ—Å—Ç—å –∞—Ä–º–∏—è > 1
                    if(gameState.lands[n].owner === 'player' && gameState.lands[n].army > 1) {
                        return true;
                    }
                }
            }
            return false;
        }

        // --- –î–ï–ô–°–¢–í–ò–Ø ---
        function recruit() {
            if(gameState.selected === null) return;
            const land = gameState.lands[gameState.selected];

            if(gameState.gold >= RECRUIT_COST) {
                gameState.gold -= RECRUIT_COST;
                land.army += 5;
                showToast("–ê—Ä–º–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∞!");
                renderMap();
                updateUI();
            } else {
                showToast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–æ–ª–æ—Ç–∞!");
            }
        }

        function attack() {
            if(gameState.selected === null) return;
            const target = gameState.lands[gameState.selected];

            // –ù–∞–π—Ç–∏ –ª—É—á—à—É—é –ø—Ä–æ–≤–∏–Ω—Ü–∏—é –¥–ª—è –∞—Ç–∞–∫–∏ (–æ—Ç–∫—É–¥–∞ –±—å–µ–º)
            let attackerIdx = -1;
            let maxPower = 0;
            const neighbors = [gameState.selected-1, gameState.selected+1, gameState.selected-4, gameState.selected+4];

            neighbors.forEach(n => {
                if(n >= 0 && n < GRID_SIZE) {
                    if(gameState.selected % 4 === 0 && n === gameState.selected - 1) return;
                    if(gameState.selected % 4 === 3 && n === gameState.selected + 1) return;

                    if(gameState.lands[n].owner === 'player' && gameState.lands[n].army > maxPower) {
                        maxPower = gameState.lands[n].army;
                        attackerIdx = n;
                    }
                }
            });

            if(attackerIdx !== -1) {
                const attacker = gameState.lands[attackerIdx];
                // –ë–æ–π
                if(attacker.army > target.army) {
                    const loss = target.army;
                    target.owner = 'player';
                    target.army = attacker.army - loss - 1; // –ù–∞—à–∏ –ø–æ—Ç–µ—Ä–∏ + –≥–∞—Ä–Ω–∏–∑–æ–Ω
                    attacker.army = 1; // –û—Å—Ç–∞–µ—Ç—Å—è –≥–∞—Ä–Ω–∏–∑–æ–Ω
                    showToast("–ü–û–ë–ï–î–ê! –ü—Ä–æ–≤–∏–Ω—Ü–∏—è –∑–∞—Ö–≤–∞—á–µ–Ω–∞.");
                } else {
                    target.army -= Math.floor(attacker.army / 1.5); // –í—Ä–∞–≥ —Ç–µ—Ä—è–µ—Ç —á–∞—Å—Ç—å
                    attacker.army = 1;
                    showToast("–ü–æ—Ä–∞–∂–µ–Ω–∏–µ... –ù–∞—à–∏ –≤–æ–π—Å–∫–∞ –ø–æ–≥–∏–±–ª–∏.");
                }
                renderMap();
                updateUI();
                selectLand(gameState.selected); // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
            }
        }

        function nextTurn() {
            gameState.turn++;

            // 1. –°–±–æ—Ä –Ω–∞–ª–æ–≥–æ–≤
            let income = 0;
            let myLands = 0;
            gameState.lands.forEach(l => {
                if(l.owner === 'player') {
                    income += INCOME_PER_LAND;
                    myLands++;
                }
            });
            gameState.gold += income;

            // 2. –•–æ–¥ –≤—Ä–∞–≥–∞ (–ò–ò)
            enemyAI();

            // 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            updateUI();
            renderMap();
            showToast(`–•–æ–¥ ${gameState.turn}. –î–æ—Ö–æ–¥: +${income}üí∞`);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã/–ø–æ—Ä–∞–∂–µ–Ω–∏—è
            if(myLands === GRID_SIZE) alert("–í–ï–°–¨ –ú–ò–† –¢–í–û–ô! –ü–û–ë–ï–î–ê!");
            if(myLands === 0) alert("–¢–≤–æ–µ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ –ø–∞–ª–æ...");
        }

        function enemyAI() {
            gameState.lands.forEach((land, idx) => {
                if(land.owner === 'enemy') {
                    // –ò–ò –Ω–∞–Ω–∏–º–∞–µ—Ç –≤–æ–π—Å–∫–∞, –µ—Å–ª–∏ –∞—Ä–º–∏—è –º–∞–ª–µ–Ω—å–∫–∞—è
                    if(land.army < 5) land.army += 3;
                    else land.army += 1; // –ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç

                    // –ü—Ä–æ—Å—Ç–∞—è –∞—Ç–∞–∫–∞ —Å–æ—Å–µ–¥–∞
                    const neighbors = [idx-1, idx+1, idx-4, idx+4];
                    for(let n of neighbors) {
                        if(n >= 0 && n < GRID_SIZE && gameState.lands[n]) {
                            // –ù–µ –∞—Ç–∞–∫—É–µ—Ç —Å–≤–æ–∏—Ö
                            if(gameState.lands[n].owner !== 'enemy') {
                                // –ï—Å–ª–∏ —É –≤—Ä–∞–≥–∞ –±–æ–ª—å—à–µ –∞—Ä–º–∏–∏ —á–µ–º —É —Å–æ—Å–µ–¥–∞
                                if(land.army > gameState.lands[n].army + 2) {
                                    gameState.lands[n].owner = 'enemy';
                                    gameState.lands[n].army = land.army - gameState.lands[n].army;
                                    land.army = 1;
                                    // –ï—Å–ª–∏ –∑–∞—Ö–≤–∞—Ç–∏–ª –∑–µ–º–ª—é –∏–≥—Ä–æ–∫–∞ - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                                    if(gameState.lands[n].owner === 'player') showToast("–í—Ä–∞–≥ –∑–∞—Ö–≤–∞—Ç–∏–ª –≤–∞—à—É –∑–µ–º–ª—é!");
                                    break; // –û–¥–Ω–∞ –∞—Ç–∞–∫–∞ –∑–∞ —Ö–æ–¥ —Å –∫–ª–µ—Ç–∫–∏
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateUI() {
            uiGold.innerText = gameState.gold;
            uiTurn.innerText = gameState.turn;
            const count = gameState.lands.filter(l => l.owner === 'player').length;
            uiProv.innerText = count;
        }

        function showToast(msg) {
            toastEl.innerText = msg;
            toastEl.style.opacity = 1;
            setTimeout(() => toastEl.style.opacity = 0, 2000);
        }

        // –°—Ç–∞—Ä—Ç
        init();

    </script>
</body>
</html>