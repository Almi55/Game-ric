<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Knight Tactics</title>
    <style>
        body {
            background-color: #121214;
            color: white;
            font-family: 'Courier New', monospace;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: manipulation;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        #ui-bar {
            width: 100%;
            padding: 15px;
            background: #1e1e24;
            display: flex;
            justify-content: space-around;
            border-bottom: 2px solid #333;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .stat { display: flex; align-items: center; gap: 5px; }
        .hp-txt { color: #ff5252; }
        .gold-txt { color: #ffd700; }

        /* –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ */
        #game-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            width: 90vw;
            max-width: 500px;
            aspect-ratio: 1;
        }

        .cell {
            background: #2a2a30;
            border-radius: 8px;
            border: 1px solid #444;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            cursor: pointer;
            position: relative;
            transition: transform 0.1s, background 0.2s;
        }

        .cell:active { transform: scale(0.95); }

        /* –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ */
        .actor {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
        }

        /* –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –Ω–∞–¥ –≥–æ–ª–æ–≤–æ–π */
        .hp-bar {
            position: absolute;
            top: 5px;
            width: 80%;
            height: 4px;
            background: #555;
            border-radius: 2px;
        }
        .hp-fill {
            height: 100%;
            background: #0f0;
            width: 100%;
            border-radius: 2px;
            transition: width 0.2s;
        }
        .enemy .hp-fill { background: #f00; }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã */
        .damage-text {
            position: absolute;
            color: #ff2222;
            font-weight: bold;
            font-size: 20px;
            animation: floatUp 0.8s forwards;
            z-index: 10;
            text-shadow: 1px 1px 0 #000;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-30px); opacity: 0; }
        }

        /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å (–ª–æ–≥–∏) */
        #log {
            position: fixed;
            bottom: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            pointer-events: none;
            text-align: center;
        }

        /* –ö–Ω–æ–ø–∫–∞ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ (—Å–∫—Ä—ã—Ç–∞) */
        #restart-btn {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ffd700;
            color: black;
            padding: 20px 40px;
            border: none;
            font-size: 24px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            z-index: 100;
        }
    </style>
</head>
<body>

    <div id="ui-bar">
        <div class="stat">‚ù§Ô∏è <span id="ui-hp" class="hp-txt">100</span></div>
        <div class="stat">‚öîÔ∏è <span id="ui-dmg">10</span></div>
        <div class="stat">üèÜ <span id="ui-score" class="gold-txt">0</span></div>
    </div>

    <div id="game-container">
        <div id="grid"></div>
    </div>

    <div id="log">–¢–∞–ø–Ω–∏ –ø–æ –∫–ª–µ—Ç–∫–µ, —á—Ç–æ–±—ã —Ö–æ–¥–∏—Ç—å –∏–ª–∏ –∞—Ç–∞–∫–æ–≤–∞—Ç—å!</div>
    <button id="restart-btn" onclick="location.reload()">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>

    <script>
        const GRID_SIZE = 5;
        const gridEl = document.getElementById('grid');
        const hpEl = document.getElementById('ui-hp');
        const scoreEl = document.getElementById('ui-score');
        const logEl = document.getElementById('log');

        let player = { x: 2, y: 2, hp: 100, maxHp: 100, dmg: 25 };
        let enemies = [];
        let score = 0;
        let turn = 1;
        let isGameOver = false;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è
        function init() {
            createGrid();
            spawnEnemy();
            spawnEnemy();
            render();
        }

        function createGrid() {
            gridEl.innerHTML = '';
            for (let y = 0; y < GRID_SIZE; y++) {
                for (let x = 0; x < GRID_SIZE; x++) {
                    let cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    cell.onclick = () => handleTap(x, y);
                    gridEl.appendChild(cell);
                }
            }
        }

        function spawnEnemy() {
            let ex, ey;
            do {
                ex = Math.floor(Math.random() * GRID_SIZE);
                ey = Math.floor(Math.random() * GRID_SIZE);
            } while ((ex === player.x && ey === player.y) || getEnemyAt(ex, ey));

            enemies.push({
                x: ex,
                y: ey,
                hp: 50,
                maxHp: 50,
                dmg: 10,
                icon: 'üëπ'
            });
        }

        function getEnemyAt(x, y) {
            return enemies.find(e => e.x === x && e.y === y);
        }

        // --- –õ–û–ì–ò–ö–ê –ò–ì–†–û–ö–ê ---
        function handleTap(x, y) {
            if (isGameOver) return;

            // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–º–æ–∂–Ω–æ —Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ 1 –∫–ª–µ—Ç–∫—É: –≤–≤–µ—Ä—Ö, –≤–Ω–∏–∑, –≤–ª–µ–≤–æ, –≤–ø—Ä–∞–≤–æ)
            const dist = Math.abs(player.x - x) + Math.abs(player.y - y);

            if (dist === 1) {
                const enemy = getEnemyAt(x, y);

                if (enemy) {
                    // –ê–¢–ê–ö–ê
                    attackEnemy(enemy);
                } else {
                    // –•–û–î
                    player.x = x;
                    player.y = y;
                    log("–¢—ã —à–∞–≥–Ω—É–ª.");
                    endTurn();
                }
            } else if (dist === 0) {
                log("–≠—Ç–æ —Ç—ã (–†—ã—Ü–∞—Ä—å)");
            } else {
                log("–°–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ!");
            }
            render();
        }

        function attackEnemy(enemy) {
            // –ò–≥—Ä–æ–∫ –±—å–µ—Ç
            enemy.hp -= player.dmg;
            showDamage(enemy.x, enemy.y, player.dmg);
            log(`–¢—ã —É–¥–∞—Ä–∏–ª –º–æ–Ω—Å—Ç—Ä–∞ –Ω–∞ -${player.dmg}`);

            if (enemy.hp <= 0) {
                // –í—Ä–∞–≥ —É–±–∏—Ç
                enemies = enemies.filter(e => e !== enemy);
                score += 10;
                player.hp = Math.min(player.hp + 10, player.maxHp); // –õ–µ—á–∏–º—Å—è –∑–∞ —É–±–∏–π—Å—Ç–≤–æ
                log("–ú–æ–Ω—Å—Ç—Ä —É–±–∏—Ç! (+10 HP)");
                spawnEnemy(); // –ù–æ–≤—ã–π –º–æ–Ω—Å—Ç—Ä
            }
            endTurn();
        }

        function endTurn() {
            // –•–æ–¥ –≤—Ä–∞–≥–æ–≤
            enemies.forEach(enemy => {
                // –ï—Å–ª–∏ –≤—Ä–∞–≥ —Ä—è–¥–æ–º —Å –∏–≥—Ä–æ–∫–æ–º - –ë–ò–¢–¨
                const dist = Math.abs(enemy.x - player.x) + Math.abs(enemy.y - player.y);

                if (dist === 1) {
                    player.hp -= enemy.dmg;
                    showDamage(player.x, player.y, enemy.dmg);
                    log(`–ú–æ–Ω—Å—Ç—Ä —É–∫—É—Å–∏–ª —Ç–µ–±—è! -${enemy.dmg} HP`);
                } else {
                    // –ò–Ω–∞—á–µ –ò–î–¢–ò –∫ –∏–≥—Ä–æ–∫—É
                    if (enemy.x < player.x && !getEnemyAt(enemy.x + 1, enemy.y)) enemy.x++;
                    else if (enemy.x > player.x && !getEnemyAt(enemy.x - 1, enemy.y)) enemy.x--;
                    else if (enemy.y < player.y && !getEnemyAt(enemy.x, enemy.y + 1)) enemy.y++;
                    else if (enemy.y > player.y && !getEnemyAt(enemy.x, enemy.y - 1)) enemy.y--;
                }
            });

            // –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç–µ—Ç
            if (Math.random() > 0.8) spawnEnemy();

            checkGameOver();
            render();
        }

        function checkGameOver() {
            if (player.hp <= 0) {
                player.hp = 0;
                isGameOver = true;
                log("–¢–´ –ü–û–ì–ò–ë...");
                document.getElementById('restart-btn').style.display = 'block';
            }
        }

        // --- –ì–†–ê–§–ò–ö–ê ---
        function render() {
            // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–ª–µ—Ç–æ–∫
            document.querySelectorAll('.cell').forEach(c => c.innerHTML = '');

            // –†–∏—Å—É–µ–º –ò–≥—Ä–æ–∫–∞
            drawActor(player.x, player.y, 'üõ°Ô∏è', player.hp, player.maxHp, false);

            // –†–∏—Å—É–µ–º –í—Ä–∞–≥–æ–≤
            enemies.forEach(e => {
                drawActor(e.x, e.y, e.icon, e.hp, e.maxHp, true);
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            hpEl.innerText = player.hp;
            scoreEl.innerText = score;
        }

        function drawActor(x, y, icon, hp, maxHp, isEnemy) {
            const cell = document.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`);
            if (!cell) return;

            const percent = (hp / maxHp) * 100;
            const colorClass = isEnemy ? 'enemy' : 'player';

            cell.innerHTML = `
                <div class="actor ${colorClass}">
                    <div class="hp-bar"><div class="hp-fill" style="width:${percent}%"></div></div>
                    <div>${icon}</div>
                </div>
            `;
        }

        function showDamage(x, y, amount) {
            const cell = document.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`);
            if (!cell) return;

            const dmgDiv = document.createElement('div');
            dmgDiv.className = 'damage-text';
            dmgDiv.innerText = `-${amount}`;
            cell.appendChild(dmgDiv);

            setTimeout(() => dmgDiv.remove(), 800);
        }

        function log(msg) {
            logEl.innerText = msg;
        }

        init();
    </script>
</body>
</html>