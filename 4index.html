<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Meme Drop Telegram</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #1a1a1a;
            font-family: 'Arial', sans-serif;
            touch-action: none; /* –û—Ç–∫–ª—é—á–∞–µ–º –∑—É–º –∏ —Å–∫—Ä–æ–ª–ª –±—Ä–∞—É–∑–µ—Ä–∞ */
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #ui-layer {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            text-align: center;
            pointer-events: none;
            z-index: 10;
        }

        #score {
            font-size: 24px;
            color: white;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        #game-over {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: white;
            z-index: 20;
            width: 80%;
        }

        button {
            background: #0088cc;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫ Matter.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
</head>
<body>

<div id="game-container">
    <div id="ui-layer">
        <div id="score">–û—á–∫–∏: 0</div>
    </div>

    <div id="game-over">
        <h1>üíÄ –ü–û–¢–†–ê–ß–ï–ù–û</h1>
        <p>–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="final-score">0</span></p>
        <button onclick="location.reload()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>
</div>

<script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò –ò–ì–†–´ ---
    // –£—Ä–æ–≤–Ω–∏ –º–µ–º–æ–≤: –æ—Ç –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –∫ –±–æ–ª—å—à–æ–º—É
    // size: —Ä–∞–¥–∏—É—Å —à–∞—Ä–∏–∫–∞
    // label: —ç–º–æ–¥–∑–∏ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏)
    const LEVELS = [
        { size: 20, color: '#FFD700', label: 'ü§°', score: 2 },  // 0: –ö–ª–æ—É–Ω
        { size: 30, color: '#FFA500', label: 'üí©', score: 4 },  // 1: –ö–∞–∫–∞—à–∫–∞
        { size: 40, color: '#FF4500', label: 'üêπ', score: 8 },  // 2: –•–æ–º—è–∫
        { size: 50, color: '#DC143C', label: 'ü™ô', score: 16 }, // 3: –ú–æ–Ω–µ—Ç–∞
        { size: 60, color: '#C71585', label: 'üí∏', score: 32 }, // 4: –î–µ–Ω—å–≥–∏
        { size: 70, color: '#8A2BE2', label: 'üöô', score: 64 }, // 5: –ì–µ–ª–∏–∫
        { size: 80, color: '#4169E1', label: 'üíé', score: 128 },// 6: –ê–ª–º–∞–∑
        { size: 90, color: '#00BFFF', label: 'üëë', score: 256 },// 7: –ö–æ—Ä–æ–Ω–∞
        { size: 100,color: '#00FA9A', label: 'üóø', score: 512 } // 8: –ì–∏–≥–∞—á–∞–¥
    ];

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–í–ò–ñ–ö–ê ---
    const Engine = Matter.Engine,
          Render = Matter.Render,
          Runner = Matter.Runner,
          Bodies = Matter.Bodies,
          Composite = Matter.Composite,
          Events = Matter.Events,
          World = Matter.World;

    const engine = Engine.create();

    // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã —ç–∫—Ä–∞–Ω–∞
    const width = window.innerWidth;
    const height = window.innerHeight;
    const wallThickness = 50;

    // –°–æ–∑–¥–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–µ—Ä
    const render = Render.create({
        element: document.getElementById('game-container'),
        engine: engine,
        options: {
            width: width,
            height: height,
            wireframes: false, // –í—ã–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º "–∫–∞—Ä–∫–∞—Å–∞", —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Ü–≤–µ—Ç–∞
            background: '#1a1a1a'
        }
    });

    // --- –°–¢–ï–ù–´ (–í–ï–î–†–û) ---
    // –ü–æ–ª
    const ground = Bodies.rectangle(width / 2, height + 25, width, 60, { isStatic: true, render: { fillStyle: '#333' } });
    // –°—Ç–µ–Ω—ã
    const leftWall = Bodies.rectangle(0, height / 2, wallThickness, height, { isStatic: true, render: { fillStyle: '#333' } });
    const rightWall = Bodies.rectangle(width, height / 2, wallThickness, height, { isStatic: true, render: { fillStyle: '#333' } });

    World.add(engine.world, [ground, leftWall, rightWall]);

    // –õ–∏–Ω–∏—è —Å–º–µ—Ä—Ç–∏ (–≤–∏–∑—É–∞–ª—å–Ω–∞—è)
    const dangerLineY = 150; 

    // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---
    let score = 0;
    let currentBall = null;
    let canDrop = true;
    let isGameOver = false;

    const scoreEl = document.getElementById('score');

    // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —à–∞—Ä–∏–∫–∞ –¥–ª—è –±—Ä–æ—Å–∫–∞ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–≤–µ—Ä—Ö—É)
    function spawnCurrentBall() {
        if (isGameOver) return;

        // –í—Å–µ–≥–¥–∞ —Å–ø–∞–≤–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 3 —É—Ä–æ–≤–Ω—è (—á—Ç–æ–±—ã –±—ã–ª–æ —á–µ—Å—Ç–Ω–æ)
        const levelIdx = Math.floor(Math.random() * 3); 
        const level = LEVELS[levelIdx];

        currentBall = Bodies.circle(width / 2, 80, level.size, {
            isStatic: true, // –ü–æ–∫–∞ –Ω–µ –±—Ä–æ—Å–∏–ª–∏ - –æ–Ω –≤–∏—Å–∏—Ç
            label: levelIdx, // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –≤ –º–µ—Ç–∫—É
            render: { fillStyle: level.color }
        });

        World.add(engine.world, currentBall);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è (–ë—Ä–æ—Å–æ–∫)
    function handleInput(e) {
        if (!canDrop || isGameOver || !currentBall) return;

        let clientX;
        if(e.type === 'touchstart') {
            clientX = e.touches[0].clientX;
        } else {
            clientX = e.clientX;
        }

        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å—Ç–µ–Ω–∞–º–∏
        const x = Math.max(wallThickness + 20, Math.min(clientX, width - wallThickness - 20));

        // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —à–∞—Ä–∏–∫ –≤ —Ç–æ—á–∫—É –∫–ª–∏–∫–∞
        Matter.Body.setPosition(currentBall, { x: x, y: 80 });

        // –í–∫–ª—é—á–∞–µ–º —Ñ–∏–∑–∏–∫—É (–±—Ä–æ—Å–∞–µ–º)
        Matter.Body.setStatic(currentBall, false);
        currentBall.restitution = 0.3; // –£–ø—Ä—É–≥–æ—Å—Ç—å

        canDrop = false;
        currentBall = null;

        // –¢–∞–π–º–µ—Ä –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞—Ä–∏–∫–∞
        setTimeout(() => {
            canDrop = true;
            spawnCurrentBall();
        }, 800);
    }

    // –°–ª—É—à–∞—Ç–µ–ª–∏ –Ω–∞–∂–∞—Ç–∏–π
    window.addEventListener('mousedown', handleInput);
    window.addEventListener('touchstart', handleInput);

    // –î–≤–∏–∂–µ–Ω–∏–µ —à–∞—Ä–∏–∫–∞ –∑–∞ –ø–∞–ª—å—Ü–µ–º/–º—ã—à–∫–æ–π (–¥–æ –±—Ä–æ—Å–∫–∞)
    window.addEventListener('mousemove', (e) => {
        if(canDrop && currentBall) {
            const x = Math.max(wallThickness + 20, Math.min(e.clientX, width - wallThickness - 20));
            Matter.Body.setPosition(currentBall, { x: x, y: 80 });
        }
    });
    window.addEventListener('touchmove', (e) => {
        if(canDrop && currentBall) {
            const x = Math.max(wallThickness + 20, Math.min(e.touches[0].clientX, width - wallThickness - 20));
            Matter.Body.setPosition(currentBall, { x: x, y: 80 });
        }
    });

    // --- –õ–û–ì–ò–ö–ê –°–õ–ò–Ø–ù–ò–Ø (MERGE) ---
    Events.on(engine, 'collisionStart', (event) => {
        const pairs = event.pairs;

        pairs.forEach((pair) => {
            const bodyA = pair.bodyA;
            const bodyB = pair.bodyB;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ —à–∞—Ä–∏–∫–∏ –∏ —É –Ω–∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
            // –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º label –∫–∞–∫ –∏–Ω–¥–µ–∫—Å —É—Ä–æ–≤–Ω—è
            // (–ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ label - —ç—Ç–æ —á–∏—Å–ª–æ)
            if (Number.isInteger(bodyA.label) && bodyA.label === bodyB.label) {
                const levelIdx = bodyA.label;

                // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å
                if (levelIdx < LEVELS.length - 1) {
                    const newLevelIdx = levelIdx + 1;
                    const newLevel = LEVELS[newLevelIdx];

                    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —à–∞—Ä–∏–∫–∞ (–ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ –º–µ–∂–¥—É –¥–≤—É–º—è —Å—Ç–∞—Ä—ã–º–∏)
                    const midX = (bodyA.position.x + bodyB.position.x) / 2;
                    const midY = (bodyA.position.y + bodyB.position.y) / 2;

                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ
                    World.remove(engine.world, [bodyA, bodyB]);

                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π, –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω—ã–π
                    const newBody = Bodies.circle(midX, midY, newLevel.size, {
                        label: newLevelIdx,
                        render: { fillStyle: newLevel.color },
                        restitution: 0.3
                    });

                    World.add(engine.world, newBody);

                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—á–∫–∏
                    score += newLevel.score;
                    scoreEl.innerText = '–û—á–∫–∏: ' + score;
                }
            }
        });
    });

    // --- –û–¢–†–ò–°–û–í–ö–ê –≠–ú–û–î–ó–ò (–•–£–ö) ---
    // Matter.js —Ä–∏—Å—É–µ—Ç –∫—Ä—É–≥–∏, –∞ –º—ã –ø–æ–≤–µ—Ä—Ö –Ω–∏—Ö —Ä–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç (—ç–º–æ–¥–∑–∏)
    Events.on(render, 'afterRender', function() {
        const context = render.context;
        const bodies = Composite.allBodies(engine.world);

        context.font = "30px Arial";
        context.textAlign = "center";
        context.textBaseline = "middle";

        // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é —Å–º–µ—Ä—Ç–∏
        context.beginPath();
        context.moveTo(0, dangerLineY);
        context.lineTo(width, dangerLineY);
        context.strokeStyle = 'rgba(255, 0, 0, 0.3)';
        context.setLineDash([10, 10]);
        context.stroke();

        bodies.forEach(body => {
            if (Number.isInteger(body.label)) {
                const level = LEVELS[body.label];
                // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —ç–º–æ–¥–∑–∏ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —à–∞—Ä–∏–∫–∞
                const fontSize = level.size * 1.2; 
                context.font = `${fontSize}px Arial`;
                context.fillText(level.label, body.position.x, body.position.y + (level.size * 0.15));
            }
        });
    });

    // --- –ü–†–û–í–ï–†–ö–ê –ü–†–û–ò–ì–†–´–®–ê ---
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ –ø–æ–ª—Å–µ–∫—É–Ω–¥—ã, –Ω–µ –≤—ã–ª–µ–∑ –ª–∏ –∫—Ç–æ –∑–∞ –ª–∏–Ω–∏—é
    setInterval(() => {
        if(isGameOver) return;

        const bodies = Composite.allBodies(engine.world);
        for(let body of bodies) {
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ç–æ—Ç —à–∞—Ä, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–µ–π—á–∞—Å –¥–µ—Ä–∂–∏–º (isStatic)
            if(!body.isStatic && body.position.y < dangerLineY) {
                // –ï—Å–ª–∏ —à–∞—Ä —É—Å–ø–æ–∫–æ–∏–ª—Å—è (–ø–æ—á—Ç–∏ –Ω–µ –¥–≤–∏–∂–µ—Ç—Å—è) –∏ –æ–Ω –≤—ã—à–µ –ª–∏–Ω–∏–∏
                if(body.velocity.y < 0.2 && body.velocity.y > -0.2) {
                    triggerGameOver();
                    break;
                }
            }
        }
    }, 1000);

    function triggerGameOver() {
        isGameOver = true;
        document.getElementById('game-over').style.display = 'block';
        document.getElementById('final-score').innerText = score;
        Runner.stop(runner); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∏–∑–∏–∫—É
    }

    // –ó–∞–ø—É—Å–∫
    spawnCurrentBall();
    const runner = Runner.create();
    Runner.run(runner, engine);
    Render.run(render);

</script>
</body>
</html>